# Bing每日壁纸自动设置工具

这个项目提供了一个简单而实用的解决方案，让您的Windows系统每天自动下载并设置Bing主页壁纸为桌面背景，同时支持自动清理旧壁纸以节省存储空间。

## 功能特点

- 自动下载当天的Bing主页壁纸
- 开机自动运行，支持等待8点后更新最新壁纸
- 壁纸可自定义保存在任意目录，避免重复下载
- 自动清理超过指定天数的旧壁纸，默认保留30天
- 提供多种运行模式：开机运行、每小时检查、固定时间运行
- 无弹窗静默运行，不干扰用户工作
- 包含详细的操作日志记录

## 文件说明

- **BingDailyWallpaper.ps1**: PowerShell脚本，自动下载当天的Bing壁纸并设置为桌面背景，包含自动清理功能
- **SetupBingWallpaper.bat**: 英文版批处理文件（推荐使用），帮助您设置开机自启动任务
- **SilentRun.vbs**: VBS脚本，用于静默运行PowerShell脚本，避免显示命令窗口弹窗
- **bing_wallpaper_fix_log.txt**: （自动生成）记录Bing壁纸下载和设置历史的日志文件
- **自定义目录**: （自动生成）Bing壁纸保存目录，可在脚本中自定义

## 使用方法

### 快速设置（推荐）

1. 以**管理员身份**运行`SetupBingWallpaper.bat`文件
2. 根据提示选择运行模式：
   - 选项1：开机时运行 - **无弹窗运行**
   - 选项2：每天早上08:10运行（Bing壁纸更新后）- **无弹窗运行**
3. 等待任务计划创建完成

> **注意**：系统会使用VBS脚本静默运行PowerShell脚本，不会显示命令窗口弹窗

### 手动运行Bing壁纸下载和设置

如果您想立即获取并设置今天的Bing壁纸：

1. 打开PowerShell（不需要管理员权限）
2. 导航到脚本所在目录
3. 运行命令：`.\BingDailyWallpaper.ps1`

## 自定义设置

### 自定义壁纸保存目录

1. 用文本编辑器打开`BingDailyWallpaper.ps1`文件
2. 找到`# Configuration`部分
3. 找到并修改`$saveFolder`变量为您想要的保存目录路径
   ```powershell
   # 示例：修改为D盘目录
   $saveFolder = "D:\TD\Pictures\BingWallpapers"
   ```
4. 保存文件

> **注意**：请确保指定的目录路径格式正确，使用双反斜杠或单斜杠分隔目录，并且您有该目录的读写权限。如果目录不存在，脚本会自动创建。

### 修改旧壁纸保留天数

1. 用文本编辑器打开`BingDailyWallpaper.ps1`文件
2. 找到`CleanupOldWallpapers`函数
3. 找到以下代码行：
   ```powershell
   $cutoffDate = (Get-Date).AddDays(-30)
   ```
4. 将`-30`修改为您想要保留的天数，例如：
   - 保留7天：`$cutoffDate = (Get-Date).AddDays(-7)`
   - 保留60天：`$cutoffDate = (Get-Date).AddDays(-60)`
   - 保留90天：`$cutoffDate = (Get-Date).AddDays(-90)`
5. 保存文件

> **注意**：清理操作在每次脚本运行时都会执行，会自动删除所有创建日期早于计算截止日期的壁纸文件。

### 修改等待行为

1. 打开`BingDailyWallpaper.ps1`文件
2. 将`$waitForUpdate`变量设置为`$true`（等待8点后更新）或`$false`（不等待）

### 修改任务计划设置

1. 按Win + R键打开运行对话框
2. 输入`taskschd.msc`并按回车
3. 在任务计划程序库中找到"开机自动设置Bing每日壁纸"任务
4. 右键点击并选择"属性"进行相应修改

## 故障排除

### 常见问题

1. **无法下载Bing壁纸**
   - 检查网络连接是否正常
   - 确认Bing API是否可访问
   - 查看bing_wallpaper_log.txt日志文件获取详细错误信息

2. **壁纸未设置成功**
   - 确认PowerShell脚本是否有足够权限设置壁纸
   - 检查壁纸文件是否成功下载到保存目录

3. **开机后壁纸未更新**
   - 确认任务计划是否正确设置为开机自启动
   - 检查是否在8点前开机，如果是且设置了等待更新，系统会等待到8点
   - 如需修改等待行为，请调整脚本中的`$waitForUpdate`参数

4. **下载的壁纸质量不佳**
   - 脚本默认下载1920x1080分辨率的壁纸，如果需要更高分辨率，可以修改脚本中的图片URL部分

## 注意事项

- 本功能需要网络连接才能下载最新的Bing壁纸
- 壁纸保存在您自定义的目录中，通过自动清理功能避免占用过多磁盘空间
- 首次运行时会自动创建壁纸保存目录
- 脚本会检查当天是否已下载壁纸，避免重复下载
- 清理操作会在每次脚本运行时执行，删除所有超过指定天数的旧壁纸
- 此工具仅在Windows操作系统上运行
- 任务计划程序设置需要管理员权限
- 所有操作都会记录到日志文件中，便于排查问题

## 版本历史

- 3.0.0: 添加自动清理旧壁纸功能，支持自定义保存目录和保留天数
- 2.0.0: 仅保留Bing每日壁纸功能，支持无弹窗静默运行
- 1.0.0: 初始版本，包含本地壁纸和Bing壁纸两种功能
